[{"id":"117f088e.84eb97","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"78f91524ad5c5f5b","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"821ed147.a04a9","type":"tab","label":"Sensors","disabled":false,"info":""},{"id":"f12f6f56.44f4d","type":"tab","label":"CSV Range Forum","disabled":false,"info":""},{"id":"44e00abd40e88a22","type":"tab","label":"Flow 3","disabled":false,"info":"","env":[]},{"id":"4dd0f326.b84a24","type":"influxdb","hostname":"127.0.0.1","port":"12447","protocol":"http","database":"firstdb","name":"influx host","usetls":false,"tls":"","influxdbVersion":"2.0","url":"http://influx-qbee:8086","rejectUnauthorized":true},{"id":"cd5463d1.62eb78","type":"influxdb","hostname":"influx","port":"8086","protocol":"http","database":"firstdb","name":"influx docker","usetls":false,"tls":"","influxdbVersion":"2.0","url":"http://influx-spc:8086/","rejectUnauthorized":false},{"id":"544a35ca.82bdbc","type":"mqtt-broker","name":"broker.x99.fr","broker":"172.18.0.14","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"f0fe03f1.28cb6","type":"influxdb","hostname":"influxdb","port":"8086","protocol":"http","database":"nodered","name":"","usetls":false,"tls":"","influxdbVersion":"1.x"},{"id":"1ed2b814.fe29c8","type":"influxdb","z":"821ed147.a04a9","hostname":"127.0.0.1","port":"8086","database":"aTimeSeries","name":"aTimeSeries","influxdbVersion":"1.x"},{"id":"eeb221fb.ab27f","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"test","name":"test","usetls":true,"tls":"d50d0c9f.31e858","influxdbVersion":"1.x","url":"http://localhost:8086","rejectUnauthorized":true},{"id":"d50d0c9f.31e858","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false},{"id":"92192c23.a0c2c","type":"influxdb","hostname":"192.168.2.185","port":"8086","protocol":"http","database":"luchtdruk","name":"Luchtdruk","usetls":false,"tls":"1e7c3760.240cb9","influxdbVersion":"1.x","url":"192.168.2.185:8086","rejectUnauthorized":false},{"id":"1e7c3760.240cb9","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":true},{"id":"cb216faf.d9136","type":"mqtt-broker","name":"","broker":"iot.eclipse.org","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"a287832d821a5490","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"database","name":"","usetls":false,"tls":"d50d0c9f.31e858","influxdbVersion":"2.0","url":"https://localhost:9999","rejectUnauthorized":false},{"id":"d4ccd3f.22375b","type":"inject","z":"117f088e.84eb97","name":"mymath","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":160,"wires":[["20e61aab.32847e"]]},{"id":"e22b91f3.eb5b38","type":"function","z":"117f088e.84eb97","name":"measurements","func":"\n\nvar mediciones = []\n\nvar Grupos = [\"Lubrificador\", \"Instalaciones\", \"Temperatura Horno/Cuba/Pieza\"]\n\nGrupos.forEach(grupo =>{\n    let valor = Math.random();\n    let timestamp = new Date()\n    let medicion = {\n        timestamp: timestamp,\n        measurement: grupo,\n        tags: {\n            molde: 'MT201',\n            medicion: 'Flow_Cir_1'\n        },\n        fields: {\n            value: Math.random(),\n            value_min: Math.random() - 20,\n            value_max: Math.random() + 20,\n         }\n    }\n    mediciones.push(medicion);\n    let medicion2 = {\n        timestamp: timestamp,\n        measurement: grupo,\n        tags: {\n            molde: 'MT201',\n            medicion: 'Flow_Cir_2'\n        },\n        fields: {\n            value: Math.random(),\n            value_min: Math.random() - 20,\n            value_max: Math.random() + 20,\n        }\n    }\n    mediciones.push(medicion2);\n    let medicion3 = {\n        timestamp: timestamp,\n        measurement: grupo,\n        tags: {\n            molde: 'MT201',\n            medicion: 'Flow_Cir_3'\n        },\n        fields: {\n            value: Math.random(),\n            value_min: Math.random() - 20,\n            value_max: Math.random() + 20,\n        }\n    }\n    mediciones.push(medicion3);\n})\n\nmsg.topic = \"mediciones\"\nmsg.payload = mediciones;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":280,"wires":[["93154639.c76a3","efc77233e7e83d23","5be21110a922020e","e4781bf814446447"]]},{"id":"93154639.c76a3","type":"debug","z":"117f088e.84eb97","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":790,"y":260,"wires":[]},{"id":"20e61aab.32847e","type":"function","z":"117f088e.84eb97","name":"ts to sec","func":"var sec = new Date(msg.payload).getSeconds();\nmsg.payload = sec;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":160,"wires":[["e22b91f3.eb5b38"]]},{"id":"241decd1d9b6d521","type":"influxdb in","z":"117f088e.84eb97","influxdb":"cd5463d1.62eb78","name":"","query":"from(bucket: \"some-bucket\")\n  |> range(start: -24h)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"Instalaciones\")\n  |> filter(fn: (r) => r[\"molde\"] == \"MT201\")\n  |> pivot(rowKey:[\"_time\"], columnKey: [\"medicion\"], valueColumn: \"_value\")\n  |> drop(columns: [\"_start\", \"_stop\", \"_field\", \"_measurement\", \"molde\"])\n  \n","rawOutput":false,"precision":"","retentionPolicy":"","org":"cie","x":430,"y":620,"wires":[["758df024a14233f5"]]},{"id":"7ea635dd23560644","type":"inject","z":"117f088e.84eb97","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"28800","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":620,"wires":[["241decd1d9b6d521"]]},{"id":"758df024a14233f5","type":"csv","z":"117f088e.84eb97","name":"","sep":",","hdrin":false,"hdrout":"all","multi":"one","ret":"\\n","temp":"_time, Flow_Cir_1, Flow_Cir_2","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":690,"y":620,"wires":[["05278a733846de51"]]},{"id":"9021cf24bed56552","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1190,"y":560,"wires":[]},{"id":"05278a733846de51","type":"file","z":"117f088e.84eb97","name":"","filename":"./datasets/spcdata.csv","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":920,"y":560,"wires":[["9021cf24bed56552"]]},{"id":"efc77233e7e83d23","type":"influxdb batch","z":"117f088e.84eb97","influxdb":"cd5463d1.62eb78","precision":"","retentionPolicy":"","name":"","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"cie","bucket":"some-bucket","x":790,"y":360,"wires":[]},{"id":"c0526a4ea5887b17","type":"uib-sender","z":"117f088e.84eb97","url":"navbar","name":"","topic":"","passthrough":true,"return":false,"outputs":1,"x":790,"y":100,"wires":[[]]},{"id":"df81cc9e.a9171","type":"inject","z":"117f088e.84eb97","name":"repeat every 10s","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1210,"y":240,"wires":[["6ca36476.d0597c"]]},{"id":"76678044.5aaeb","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1770,"y":220,"wires":[]},{"id":"bd9b5761.fb4918","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1750,"y":260,"wires":[]},{"id":"b18a50dd.f7e5c","type":"uibuilder","z":"117f088e.84eb97","name":"","topic":"","url":"vue-file","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"copyIndex":true,"templateFolder":"vue-simple","extTemplate":"","showfolder":true,"reload":false,"sourceFolder":"src","deployedVersion":"5.0.2","x":1580,"y":240,"wires":[["76678044.5aaeb"],["bd9b5761.fb4918"]]},{"id":"6ca36476.d0597c","type":"change","z":"117f088e.84eb97","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"greeting\":\"Goodness aaaa me\",\"who\":\"little fishy\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":240,"wires":[["b18a50dd.f7e5c"]]},{"id":"d8fc3df399de6e53","type":"uibuilder","z":"117f088e.84eb97","name":"","topic":"","url":"navbar","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"copyIndex":true,"templateFolder":"external","extTemplate":"unborn-andy/uib-template-vue-navbar","showfolder":false,"reload":false,"sourceFolder":"dist","deployedVersion":"5.0.2","x":1440,"y":180,"wires":[[],[]]},{"id":"7d6c36094705e87d","type":"create dataset","z":"117f088e.84eb97","name":"dataset","path":"./datasets/spcdata.csv","saveFolder":"./datasets","saveName":"datasettest","input":"0,1","output":"2","trainingPartition":"80","shuffle":true,"seed":"1","x":700,"y":720,"wires":[["fc5b32e9af79fe9a"]]},{"id":"86a363f1c622f751","type":"inject","z":"117f088e.84eb97","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":440,"y":720,"wires":[["7d6c36094705e87d"]]},{"id":"0e8fdcb0285b566e","type":"comment","z":"117f088e.84eb97","name":"WEB CLIENT","info":"","x":1430,"y":100,"wires":[]},{"id":"18a2ebada7db7b07","type":"comment","z":"117f088e.84eb97","name":"OBTENER DATOS + BDD","info":"","x":370,"y":100,"wires":[]},{"id":"acb5d7f7c58aeaad","type":"comment","z":"117f088e.84eb97","name":"MACHINE LEARNING","info":"","x":580,"y":560,"wires":[]},{"id":"fc5b32e9af79fe9a","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":720,"wires":[]},{"id":"5aabc0030e488556","type":"load dataset","z":"117f088e.84eb97","name":"mediciones","datasetFolder":"./datasets","datasetName":"datasettest","partition":"train.csv","input":true,"output":true,"x":570,"y":820,"wires":[["d0b7f664307a0798"],[]]},{"id":"4ef0c6111f737ef7","type":"inject","z":"117f088e.84eb97","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":820,"wires":[["5aabc0030e488556"]]},{"id":"d0b7f664307a0798","type":"random forest classifier","z":"117f088e.84eb97","name":"","savePath":"./models","saveName":"modeltree","criterion":"gini","numTrees":"10","maxDepth":"","x":830,"y":820,"wires":[["7a7352ca242172aa"],[]]},{"id":"7a7352ca242172aa","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1090,"y":820,"wires":[]},{"id":"842399b7a38467cd","type":"exec","z":"117f088e.84eb97","command":"python","addpay":"","append":"/data/ml.py","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"ML","x":390,"y":920,"wires":[["25b8e16388294a13"],[],[]]},{"id":"b2f9a5dac6b299e5","type":"inject","z":"117f088e.84eb97","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":920,"wires":[["842399b7a38467cd"]]},{"id":"25b8e16388294a13","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":920,"wires":[]},{"id":"0870c0b53d91d9ed","type":"predictor","z":"117f088e.84eb97","name":"modelo","modelPath":"","modelName":"model.sav","x":520,"y":1040,"wires":[["3d477b172cc8c27b"],[]]},{"id":"010613b9fb9c95a8","type":"inject","z":"117f088e.84eb97","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":1040,"wires":[["64f33a3ad4dc147e"]]},{"id":"64f33a3ad4dc147e","type":"function","z":"117f088e.84eb97","name":"","func":"\nmsg.payload = {\"a\":[Math.random(), Math.random()+2,Math.random()+1], \"b\":[Math.random()-3,Math.random()+2,Math.random()+3]}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":1040,"wires":[["0870c0b53d91d9ed"]]},{"id":"3d477b172cc8c27b","type":"debug","z":"117f088e.84eb97","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":750,"y":1040,"wires":[]},{"id":"5be21110a922020e","type":"uib-cache","z":"117f088e.84eb97","cacheall":false,"cacheKey":"topic","num":"4","storeName":"memory","name":"","x":570,"y":180,"wires":[["c0526a4ea5887b17"]]},{"id":"c0fd5de1ea5b50a6","type":"http in","z":"117f088e.84eb97","name":"","url":"/mediciones","method":"get","upload":false,"swaggerDoc":"","x":440,"y":440,"wires":[["77015ed9da7fb080"]]},{"id":"77015ed9da7fb080","type":"template","z":"117f088e.84eb97","name":"","field":"med","fieldType":"flow","format":"handlebars","syntax":"mustache","template":"{{med}}","output":"json","x":680,"y":440,"wires":[["2d1f2f5b4be2b652"]]},{"id":"2d1f2f5b4be2b652","type":"http response","z":"117f088e.84eb97","name":"","statusCode":"","headers":{},"x":870,"y":440,"wires":[]},{"id":"e4781bf814446447","type":"change","z":"117f088e.84eb97","name":"","rules":[{"t":"set","p":"payload","pt":"flow","to":"med","tot":"flow","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":340,"wires":[[]]},{"id":"9d9141a6.1b19d","type":"influxdb in","z":"f12f6f56.44f4d","influxdb":"92192c23.a0c2c","name":"Read from InfluxDB","query":"SELECT \"time\",\"luchtdruk\" FROM \"luchtdruk\" WHERE time > now() - 1h","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":310,"y":80,"wires":[["63535a51.f1eac4"]]},{"id":"fc96823.e15978","type":"inject","z":"f12f6f56.44f4d","name":"Inject","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":80,"wires":[["9d9141a6.1b19d"]]},{"id":"9bbfcc1.a59393","type":"debug","z":"f12f6f56.44f4d","name":"Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":690,"y":80,"wires":[]},{"id":"63535a51.f1eac4","type":"csv","z":"f12f6f56.44f4d","name":"Generate CSV","sep":",","hdrin":false,"hdrout":"none","multi":"one","ret":"\\n","temp":"time,luchtdruk","skip":"0","strings":true,"include_empty_strings":false,"include_null_values":false,"x":520,"y":80,"wires":[["9bbfcc1.a59393"]]},{"id":"2cd8ba30b950b5c8","type":"create dataset","z":"44e00abd40e88a22","name":"","path":"test/iris.data","saveFolder":"test/datasets","saveName":"iris","input":"0,1,2,3","output":"4","trainingPartition":"","shuffle":true,"seed":"","x":480,"y":120,"wires":[["c4ab6972373ac643"]]},{"id":"da4a9c7319c14b6a","type":"load dataset","z":"44e00abd40e88a22","name":"","datasetFolder":"test/datasets","datasetName":"iris","partition":"train.csv","input":true,"output":true,"x":430,"y":240,"wires":[["56c6aa99a8265176"],["5e91711b10fb0748"]]},{"id":"95d1aade0e3c78ee","type":"inject","z":"44e00abd40e88a22","name":"start","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":120,"wires":[["2cd8ba30b950b5c8"]]},{"id":"258f7b67621c69d8","type":"inject","z":"44e00abd40e88a22","name":"start","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":240,"wires":[["da4a9c7319c14b6a"]]},{"id":"ecaa637ce623ed15","type":"inject","z":"44e00abd40e88a22","name":"start","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":480,"wires":[["305d69b4354b74ac","68f8f206c04b5644"]]},{"id":"c4ab6972373ac643","type":"debug","z":"44e00abd40e88a22","name":"print","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":710,"y":120,"wires":[]},{"id":"5e91711b10fb0748","type":"debug","z":"44e00abd40e88a22","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":910,"y":280,"wires":[]},{"id":"ec33e50bcf983127","type":"debug","z":"44e00abd40e88a22","name":"print","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":890,"y":200,"wires":[]},{"id":"e998813ac4d7fd5b","type":"predictor","z":"44e00abd40e88a22","name":"decision tree classifier predictor","modelPath":"test/models","modelName":"dtc.b","x":690,"y":460,"wires":[["5ef75a04089b8670"],["d0ed1547f49e83b8"]]},{"id":"56c6aa99a8265176","type":"decision tree classifier","z":"44e00abd40e88a22","name":"decision tree classifier trainer","savePath":"test/models","saveName":"dtc.b","maxDepth":"","criterion":"gini","splitter":"best","x":680,"y":240,"wires":[["ec33e50bcf983127"],["5e91711b10fb0748"]]},{"id":"5ef75a04089b8670","type":"assessment","z":"44e00abd40e88a22","name":"","score":"accuracy_score","x":730,"y":400,"wires":[["8f438bdc75853439"],["d0ed1547f49e83b8"]]},{"id":"305d69b4354b74ac","type":"load dataset","z":"44e00abd40e88a22","name":"","datasetFolder":"test/datasets","datasetName":"iris","partition":"test.csv","input":false,"output":true,"x":430,"y":400,"wires":[["5ef75a04089b8670"],["d0ed1547f49e83b8"]]},{"id":"68f8f206c04b5644","type":"load dataset","z":"44e00abd40e88a22","name":"","datasetFolder":"test/datasets","datasetName":"iris","partition":"test.csv","input":true,"output":false,"x":430,"y":520,"wires":[["e998813ac4d7fd5b"],["d0ed1547f49e83b8"]]},{"id":"d0ed1547f49e83b8","type":"debug","z":"44e00abd40e88a22","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":930,"y":520,"wires":[]},{"id":"8f438bdc75853439","type":"debug","z":"44e00abd40e88a22","name":"print","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":400,"wires":[]},{"id":"d43a462504223106","type":"predictor","z":"44e00abd40e88a22","name":"decision tree classifier predictor","modelPath":"test/models","modelName":"dtc.b","x":590,"y":620,"wires":[["d5551caf1d27e515"],["a6bd219293a5fe66"]]},{"id":"d5551caf1d27e515","type":"mqtt out","z":"44e00abd40e88a22","name":"","topic":"predictions","qos":"","retain":"","broker":"cb216faf.d9136","x":870,"y":580,"wires":[]},{"id":"a6bd219293a5fe66","type":"debug","z":"44e00abd40e88a22","name":"error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":850,"y":660,"wires":[]},{"id":"153a3fefb2c9fa96","type":"mqtt in","z":"44e00abd40e88a22","name":"","topic":"classification","qos":"2","broker":"cb216faf.d9136","inputs":0,"x":280,"y":620,"wires":[["d43a462504223106"]]}]